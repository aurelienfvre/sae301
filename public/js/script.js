function toggleDropdown(e){document.getElementById(e).classList.toggle("show")}function updateSelectedFilters(){let e=document.getElementById("selected-filters");e.innerHTML="";let t=document.querySelectorAll('.dropdown-content input[type="checkbox"]:checked');t.forEach(function(t){let n=t.parentNode.textContent.trim(),r=document.createElement("div");r.className="filter-tag",r.textContent=n;let a=document.createElement("span");a.className="remove-tag",a.innerHTML="&times;",a.onclick=function(){t.checked=!1,r.remove(),updateSelectedFilters(),updateDropdownCount(t.closest(".dropdown-content").id),applyFiltersAndSearch()},r.appendChild(a),e.appendChild(r)})}function clearDropdownSelection(e){let t=document.querySelectorAll("#"+e+' input[type="checkbox"]');t.forEach(e=>e.checked=!1),updateSelectedFilters(),updateDropdownCount(e),applyFiltersAndSearch()}function updateDropdownCount(e){let t=document.querySelectorAll("#"+e+' input[type="checkbox"]:checked').length,n=document.querySelector("[onclick=\"toggleDropdown('"+e+"')\"]"),r=n?n.querySelector(".dropdown-count"):null;r&&(r.textContent=t.toString())}document.addEventListener("DOMContentLoaded",function(){let e=new Date,t;t=e.toLocaleDateString("fr-FR",{day:"numeric",month:"long",year:"numeric"}),document.querySelector(".titles-container h2").textContent=t}),window.onclick=function(e){if(!e.target.matches(".dropbtn")&&!e.target.matches(".dropdown-clear")){let t=document.getElementsByClassName("dropdown-content");for(let n=0;n<t.length;n++){let r=t[n];r.classList.contains("show")&&r.classList.remove("show")}}},document.querySelectorAll('.dropdown-content input[type="checkbox"]').forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation()})}),document.querySelectorAll('.dropdown-content input[type="checkbox"]').forEach(function(e){e.addEventListener("change",function(){updateSelectedFilters(),updateDropdownCount(e.closest(".dropdown-content").id)})}),document.querySelectorAll(".dropdown-clear").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation();let t=this.closest(".dropdown").querySelector(".dropdown-content").id;clearDropdownSelection(t)})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("clear-filters");e||((e=document.createElement("button")).id="clear-filters",e.style.display="none",document.body.appendChild(e)),document.querySelectorAll(".dropdown-clear").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation();clearDropdownSelection(this.closest(".dropdown").querySelector(".dropdown-content").id)})});let t=document.getElementsByClassName("dropdown-content");for(let n=0;n<t.length;n++)updateDropdownCount(t[n].id);e.addEventListener("click",function(){let e=document.querySelectorAll('.dropdown-content input[type="checkbox"]');e.forEach(e=>e.checked=!1),updateSelectedFilters(),applyFiltersAndSearch();let t=document.getElementsByClassName("dropdown-content");for(let n=0;n<t.length;n++)updateDropdownCount(t[n].id)}),document.querySelectorAll(".dropdown-clear").forEach(function(e){e.addEventListener("click",function(e){e.stopPropagation();let t=this.closest(".dropdown").querySelector(".dropdown-content").id;clearDropdownSelection(t)})})}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByClassName("dropdown-content");for(let t=0;t<e.length;t++)updateDropdownCount(e[t].id)}),moment.locale("fr");let currentMonth=moment();const calendarEl=document.getElementById("calendar"),monthYearEl=document.getElementById("monthYear"),currentDateDisplayEl=document.getElementById("currentDateDisplay");let selectedDate=moment(),selectedCalendarDate="";function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function updateCurrentDateDisplay(){currentDateDisplayEl.textContent=capitalizeFirstLetter(selectedDate.format("dddd D MMM").replace(/\./g,"")),monthYearEl.textContent=capitalizeFirstLetter(selectedDate.format("MMMM YYYY"))}function renderCalendar(){calendarEl.innerHTML="";let e=moment.weekdaysMin(!0);e.forEach(e=>{let t=document.createElement("div");t.className="day-header",t.textContent=e.charAt(0).toUpperCase()+e.slice(1),calendarEl.appendChild(t)});let t=currentMonth.clone().startOf("month"),n=currentMonth.clone().endOf("month"),r=t.clone();for(;r.isSameOrBefore(n);){let a=document.createElement("div");a.className="day",a.textContent=r.format("D");let d=r.clone();a.onclick=()=>{selectedDate=d,selectedCalendarDate=d.format("YYYY-MM-DD"),updateCurrentDateDisplay(),updateSelection(),applyFiltersAndSearch()},d.isSame(selectedDate,"day")&&a.classList.add("selected"),calendarEl.appendChild(a),r.add(1,"day")}updateCurrentDateDisplay()}function updateSelection(){document.querySelectorAll(".day").forEach(e=>{let t=moment(e.textContent,"D").month(currentMonth.month()).year(currentMonth.year());e.classList.remove("selected"),t.isSame(selectedDate,"day")&&t.isSame(currentMonth,"month")&&e.classList.add("selected")})}function changeMonth(e){currentMonth.add(e,"months"),selectedDate=currentMonth.clone().startOf("month"),renderCalendar()}function normalizeString(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}function applyFiltersAndSearch(){let e=normalizeString(document.getElementById("search-input").value),t=Array.from(document.querySelectorAll('#date-dropdown input[type="checkbox"]:checked')).map(e=>normalizeString(e.value)),n=Array.from(document.querySelectorAll('#matieres-dropdown input[type="checkbox"]:checked')).map(e=>normalizeString(e.value)),r=Array.from(document.querySelectorAll('#group-dropdown input[type="checkbox"]:checked')).map(e=>normalizeString(e.value)),a=Array.from(document.querySelectorAll('#semestre-dropdown input[type="checkbox"]:checked')).map(e=>normalizeString(e.value)),d=document.querySelectorAll(".card");d.forEach(function(d){let l=normalizeString(d.getAttribute("data-date")),o=normalizeString(d.getAttribute("data-matiere")),c=normalizeString(d.getAttribute("data-groupe")),i=normalizeString(d.getAttribute("data-semestre")),s=0===t.length||t.includes(l),u=0===n.length||n.includes(o),p=0===r.length||r.includes(c),m=0===a.length||a.includes(i),h=""===selectedCalendarDate||l===selectedCalendarDate,y=""===e||l.includes(e)||o.includes(e)||c.includes(e)||i.includes(e)||d.querySelector(".details").textContent.toLowerCase().includes(e)||d.querySelector(".email-address").textContent.toLowerCase().includes(e);d.style.display=s&&u&&p&&m&&y&&h?"":"none"})}function initializeDarkModeToggle(){let e=document.body,t=document.getElementById("lightModeIcon"),n=document.getElementById("darkModeIcon");"true"===localStorage.getItem("darkMode")&&(e.classList.add("dark-mode"),t&&n&&(t.style.display="none",n.style.display="block"));let r=document.querySelector(".mod-button a");r&&r.addEventListener("click",function(r){r.preventDefault(),e.classList.toggle("dark-mode"),localStorage.setItem("darkMode",e.classList.contains("dark-mode")),t&&n&&(t.style.display=e.classList.contains("dark-mode")?"none":"block",n.style.display=e.classList.contains("dark-mode")?"block":"none")})}function addReminderToSidebar(e){let t=e.getAttribute("data-card-id");if(document.getElementById(`reminder-${t}`)){alert("Ce rappel a d\xe9j\xe0 \xe9t\xe9 ajout\xe9.");return}let n=e.getAttribute("data-card-class"),r=e.getAttribute("data-card-title"),a=e.getAttribute("data-card-details"),d=e.getAttribute("data-card-detail-items"),l=e.getAttribute("data-card-date"),o=document.getElementById("reminderList"),c=document.createElement("div");c.id=`reminder-${t}`,c.className=`reminder-card ${n}`,c.style.color="blue"===n?"#FFFFFF":"#000000",c.innerHTML=`
    <div class="reminder-checkbox-container">
        <input type="checkbox" class="reminder-checkbox" data-card-id="${t}" onchange="toggleCardAndReminder('${t}', this.checked)">
        <label for="reminder-checkbox-${t}"></label>
    </div>
        <div class="reminder-date">${l}</div>
        <div class="reminder-title">${r}</div>
        <div class="reminder-details">${a} ${d}</div>
        
    </div>
    `,o.appendChild(c)}function toggleCardAndReminder(e,t){let n=document.querySelector(`.card-checkbox[data-card-id="${e}"]`),r=document.querySelector(`.reminder-checkbox[data-card-id="${e}"]`);setTimeout(()=>{if(n&&(n.checked=t,n.closest(".card").style.display=t?"none":""),r){r.checked=t;let a=document.getElementById(`reminder-${e}`);a&&(a.style.display=t?"none":"")}},200)}function toggleEditMode(e){let t=document.querySelector(`#card-${e}`),n=t.classList.contains("editable");if(n){let r={};t.querySelectorAll(".editable").forEach(e=>{let t=e.querySelector("input");if(t){let n=e.dataset.field,a=t.value.trim();r[n]=a,e.innerHTML=a}}),r.card_detail_items=[],t.querySelectorAll(".card-details li.editable").forEach(e=>{let t=e.querySelector("input");if(t){let n=t.value.trim();r.card_detail_items.push(n),e.innerHTML=n}}),saveCardData(e,r),t.classList.remove("editable")}else t.querySelectorAll(".editable").forEach(e=>{let t=e.textContent.trim();e.setAttribute("data-original-content",t);let n=document.createElement("input");n.type="text",n.value=t,e.innerHTML="",e.appendChild(n)}),t.classList.add("editable")}function saveCardData(e,t){fetch(`/update-card/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(e=>e.json()).then(e=>{console.log(e)}).catch(e=>{console.error("Error:",e)})}function updateActiveNavLink(e){document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),document.querySelectorAll(".nav-item a").forEach(t=>{t.getAttribute("href")===e&&t.closest(".nav-item").classList.add("active")})}document.querySelectorAll('.dropdown-content input[type="checkbox"]').forEach(function(e){e.addEventListener("change",applyFiltersAndSearch)}),document.getElementById("search-input").addEventListener("input",applyFiltersAndSearch),document.addEventListener("DOMContentLoaded",function(){selectedCalendarDate="",applyFiltersAndSearch(),renderCalendar()}),renderCalendar(),document.addEventListener("DOMContentLoaded",function(){initializeDarkModeToggle()}),document.querySelectorAll(".card-checkbox").forEach(e=>{e.addEventListener("change",function(){let e=this.getAttribute("data-card-id");toggleCardAndReminder(e,this.checked)})}),document.querySelectorAll(".reminder-checkbox").forEach(e=>{e.addEventListener("change",function(){let e=this.getAttribute("data-card-id"),t=this.checked;setTimeout(()=>{toggleCardAndReminder(e,t)},200)})}),document.addEventListener("DOMContentLoaded",function(){updateActiveNavLink(window.location.pathname),document.querySelectorAll(".nav-item a").forEach(e=>{e.addEventListener("click",function(e){document.querySelectorAll(".nav-item").forEach(e=>{e.classList.remove("active")}),this.closest(".nav-item").classList.add("active")})})}),document.addEventListener("DOMContentLoaded",function(){var e=cardsData.map(e=>({title:e.card_title,start:e.card_date,details:e.card_details,detailItems:e.card_detail_items.join(", "),email:e.card_email||"Non sp\xe9cifi\xe9",rank:e.card_rank,group:e.card_group})),t=document.getElementById("calendar_event");new FullCalendar.Calendar(t,{locale:"fr",initialView:"dayGridMonth",events:e,eventClick:function(e){document.getElementById("eventModalLabel").textContent=e.event.title,document.getElementById("eventDetails").textContent="Rendu : "+e.event.extendedProps.details,document.getElementById("eventItems").textContent="D\xe9tail du rendu : "+e.event.extendedProps.detailItems,document.getElementById("eventEmail").textContent="O\xf9 le rendre : "+e.event.extendedProps.email,document.getElementById("eventRank").textContent="Semestre : "+e.event.extendedProps.rank,document.getElementById("eventGroup").textContent="Groupe : "+e.event.extendedProps.group,new bootstrap.Modal(document.getElementById("eventModal")).show()}}).render()});